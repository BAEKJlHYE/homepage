<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="anonymous.homepage.buld.dao.BuldMapper">
    <!-- 건물 목록 조회 -->
    <select id="selectBuldList" resultType="anonymous.homepage.buld.vo.BuldVO">
        SELECT BULD_NO
             , BULD_NM
             , ZIPCD
             , ADDR
             , DETAIL_ADDR
             , DELNG_TY_SE_CD
             , (SELECT CD_NM FROM CD WHERE CD = DELNG_TY_SE_CD) AS DELNG_TY_SE_NM
             , GTN
             , PRICE
             , CNTRCT_STTUS_SE_CD
             , (SELECT CD_NM FROM CD WHERE CD = CNTRCT_STTUS_SE_CD) AS CNTRCT_STTUS_SE_NM
             , RL_FLOOR
             , TOT_FLOOR
             , DVR_AR
             , DVR_RL_AEA
             , SUPLY_AR
             , SUPLY_RL_AEA
             , COMPET_YEAR
             , NVL(MVN_DE, '협의 후 가능') AS MVN_DE
             , SALE_SE_CD
             , (SELECT CD_NM FROM CD WHERE CD = SALE_SE_CD) AS SALE_SE_NM
             , TEL_NO
             , RECOMEND_SALE_YN
             , EMRGNCY_SALE_YN
             , REGIST_ID
             , REGIST_DT
             , UPDATE_ID
             , UPDATE_DT
             , ATCH_DOC_ID
             , RNTCHRG
             , MANAGECT
             , PREMUM
             , BULD_DC
             , LOGO_TY
        FROM BULD
        ORDER BY BULD_NO DESC
    </select>

     <!-- 건물 조회 -->
     <select id="selectBuld" parameterType="anonymous.homepage.buld.vo.BuldVO" resultType="anonymous.homepage.buld.vo.BuldVO">
          SELECT BULD_NO
               , BULD_NM
               , ZIPCD
               , ADDR
               , DETAIL_ADDR
               , DELNG_TY_SE_CD
               , (SELECT CD_NM FROM CD WHERE CD = DELNG_TY_SE_CD) AS DELNG_TY_SE_NM
               , GTN
               , PRICE
               , CNTRCT_STTUS_SE_CD
               , (SELECT CD_NM FROM CD WHERE CD = CNTRCT_STTUS_SE_CD) AS CNTRCT_STTUS_SE_NM
               , RL_FLOOR
               , TOT_FLOOR
               , DVR_AR
               , DVR_RL_AEA
               , SUPLY_AR
               , SUPLY_RL_AEA
               , COMPET_YEAR
               , NVL(MVN_DE, '협의 후 가능') AS MVN_DE
               , SALE_SE_CD
               , (SELECT CD_NM FROM CD WHERE CD = SALE_SE_CD) AS SALE_SE_NM
               , TEL_NO
               , RECOMEND_SALE_YN
               , EMRGNCY_SALE_YN
               , REGIST_ID
               , REGIST_DT
               , UPDATE_ID
               , UPDATE_DT
               , ATCH_DOC_ID
               , RNTCHRG
               , MANAGECT
               , PREMUM
               , BULD_DC
               , LOGO_TY
          FROM BULD
          WHERE BULD_NO = #{buldNo}
     </select>

     <!-- 건물 등록 -->
     <insert id="insertBuld" parameterType="anonymous.homepage.buld.vo.BuldVO">
          <selectKey keyProperty="buldNo" resultType="String" order="BEFORE">
               SELECT LPAD(NVL(MAX(TO_NUMBER(BULD_NO)), 0) + 1, 6, 0) AS BULD_NO
               FROM BULD
          </selectKey>
          INSERT INTO BULD (
               BULD_NO
               , BULD_NM
               , ZIPCD
               , ADDR
               , DETAIL_ADDR
               , DELNG_TY_SE_CD
               , GTN
               , PRICE
               , CNTRCT_STTUS_SE_CD
               , RL_FLOOR
               , TOT_FLOOR
               , DVR_AR
               , DVR_RL_AEA
               , SUPLY_AR
               , SUPLY_RL_AEA
               , COMPET_YEAR
               , MVN_DE
               , SALE_SE_CD
               , TEL_NO
               , RECOMEND_SALE_YN
               , EMRGNCY_SALE_YN
               , REGIST_ID
               , REGIST_DT
               , UPDATE_ID
               , UPDATE_DT
               , ATCH_DOC_ID
               , RNTCHRG
               , MANAGECT
               , PREMUM
               , BULD_DC
               , LOGO_TY
          )
          VALUES (
               #{buldNo}
               , #{buldNm}
               , #{zipcd}
               , #{addr}
               , #{detailAddr}
               , #{delngTySeCd}
               , #{gtn, jdbcType=VARCHAR}
               , #{price, jdbcType=VARCHAR}
               , #{cntrctSttusSeCd}
               , #{rlFloor, jdbcType=VARCHAR}
               , #{totFloor, jdbcType=VARCHAR}
               , #{dvrAr, jdbcType=VARCHAR}
               , #{dvrRlAea, jdbcType=VARCHAR}
               , #{suplyAr, jdbcType=VARCHAR}
               , #{suplyRlAea, jdbcType=VARCHAR}
               , #{competYear, jdbcType=VARCHAR}
               , #{mvnDe, jdbcType=VARCHAR}
               , #{saleSeCd}
               , #{telNo}
               , #{recomendSaleYn, jdbcType=VARCHAR}
               , #{emrgncySaleYn, jdbcType=VARCHAR}
               , #{userId}
               , SYSDATE
               , #{userId}
               , SYSDATE
               , #{atchDocId, jdbcType=VARCHAR}
               , #{rntchrg, jdbcType=VARCHAR}
               , #{managect, jdbcType=VARCHAR}
               , #{premum, jdbcType=VARCHAR}
               , #{buldDc, jdbcType=VARCHAR}
               , #{logoTy}
          )
     </insert>

     <!-- 건물 수정 -->
     <update id="updateBuld" parameterType="anonymous.homepage.buld.vo.BuldVO">
          UPDATE BULD
          SET BULD_NM               = #{buldNm, jdbcType=VARCHAR}
            , ZIPCD                 = #{zipcd, jdbcType=VARCHAR}
            , ADDR                  = #{addr, jdbcType=VARCHAR}
            , DETAIL_ADDR           = #{detailAddr, jdbcType=VARCHAR}
            , DELNG_TY_SE_CD        = #{delngTySeCd, jdbcType=VARCHAR}
            , GTN                   = #{gtn, jdbcType=VARCHAR}
            , PRICE                 = #{price, jdbcType=VARCHAR}
            , CNTRCT_STTUS_SE_CD    = #{cntrctSttusSeCd, jdbcType=VARCHAR}
            , RL_FLOOR              = #{rlFloor, jdbcType=VARCHAR}
            , TOT_FLOOR             = #{totFloor, jdbcType=VARCHAR}
            , DVR_AR                = #{dvrAr, jdbcType=VARCHAR}
            , DVR_RL_AEA            = #{dvrRlAea, jdbcType=VARCHAR}
            , SUPLY_AR              = #{suplyAr, jdbcType=VARCHAR}
            , SUPLY_RL_AEA          = #{suplyRlAea, jdbcType=VARCHAR}
            , COMPET_YEAR           = #{competYear, jdbcType=VARCHAR}
            , MVN_DE                = #{mvnDe, jdbcType=VARCHAR}
            , SALE_SE_CD            = #{saleSeCd, jdbcType=VARCHAR}
            , TEL_NO                = #{telNo, jdbcType=VARCHAR}
            , RECOMEND_SALE_YN      = #{recomendSaleYn, jdbcType=VARCHAR}
            , EMRGNCY_SALE_YN       = #{emrgncySaleYn, jdbcType=VARCHAR}
            , UPDATE_ID             = #{userId, jdbcType=VARCHAR}
            , UPDATE_DT             = SYSDATE
            , ATCH_DOC_ID           = #{atchDocId, jdbcType=VARCHAR}
            , RNTCHRG               = #{rntchrg, jdbcType=VARCHAR}
            , MANAGECT              = #{managect, jdbcType=VARCHAR}
            , PREMUM                = #{premum, jdbcType=VARCHAR}
            , BULD_DC               = #{buldDc, jdbcType=VARCHAR}
            , LOGO_TY               = #{logoTy, jdbcType=VARCHAR}
          WHERE BULD_NO = #{buldNo}
     </update>
</mapper>